                 ┌─────────────────────┐
                 │        BOOT         │
                 └──────────┬──────────┘
                            ▼
              ┌────────────────────────────┐
              │ Vérif Soleil + Victron OK  │
              └──────────┬─────────────────┘
                         │Oui
                         ▼
                ┌───────────────────┐
                │  start_sequence   │
                └──────┬────────────┘
                       ▼
        ┌────────────────────────────┐
        │  Mise sous tension R48 AC  │
        └─────────────┬──────────────┘
                      ▼
             ┌──────────────────┐
             │  CAN R48 actif ? │─────────┐Non
             └───────┬──────────┘         │ FAIL
                     ▼                    ▼
           ┌─────────────────────┐   handle_critical_error
           │  Réglage 48V + %,A  │
           └──────────┬──────────┘
                      ▼
           ┌─────────────────────┐
           │    DC R48 OFF→ON    │
           └──────────┬──────────┘
                      ▼
       ┌─────────────────────────────┐
       │    Tension battery logic    │
       │    (VIC→tension DPS)        │
       └──────────┬──────────────────┘
                  ▼
     ┌──────────────────────────┐
     │    Démarrage du DPS      │
     └──────────┬───────────────┘
                ▼
    ┌────────────────────────────────┐
    │      CHARGE ACTIVE (Loop)     │
    └───────┬──────────────┬────────┘
            │              │
            │              │
      Victron change   Lazy Limiter
            │              │
            ▼              ▼
   calcul tension →    calcul courant
   slew rate 0.1V/3s    0–19.5 A

            │
            ▼
  ┌─────────────────────────────┐
  │  Watchdogs (périodiques)   │
  └──────────┬──────────┬──────┘
             │          │
             │          ├────> CAN R48
             │          │
             │          ├────> Modbus DPS
             │          │
             │          ├────> Temp R48
             │          │
             │          ├────> Surtension batt
             │          │
             │          └────> Charge bloquée
             ▼
    OK → continue   /   FAIL → handle_critical_error

